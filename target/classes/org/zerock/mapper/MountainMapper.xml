<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.mapper.MountainMapper">

<sql id="criteria">
<where>
	<foreach item="type" collection="typeArr" separator="OR">
		<choose>
			<when test="type == 'T'.toString()">
				title LIKE '%' || #{keyword} || '%'
			</when>
			<when test="type == 'C'.toString()">
				content LIKE '%' || #{keyword} || '%'
			</when>
			<when test="type == 'W'.toString()">
				writer LIKE '%' || #{keyword} || '%'
			</when>
		</choose>
	</foreach>
</where>
</sql>

<select id="getList" resultType="org.zerock.domain.MountainVO">
<![CDATA[

      select * from mountain where no>0

]]>
</select>

<select id="getListWithPaging" resultType="org.zerock.domain.MountainVO">
<![CDATA[
SELECT 
no, mName, mLoc, height, status
FROM
(
SELECT 
ROW_NUMBER() OVER (ORDER BY no) rn,
no, mName, mLoc, height, status
FROM 
mountain
]]>
	  
 <include refid="criteria"></include> 
 
 <![CDATA[
 )WHERE 
 rn BETWEEN (#{pageNum} - 1) * #{amount} + 1 AND #{pageNum} * #{amount}
 ]]>

</select>

<insert id="insertSelectKey">
		<selectKey keyProperty="no" order="BEFORE"
			resultType="long">
			select MAX(no)+1 from dual
		</selectKey>

		insert into tbl_mountain (no, mName, mLoc , height, status)
		values (#{no },
		#{mName}, #{mLoc}, #{height}, #{status})
	</insert>
	
	<select id="read" resultType="org.zerock.domain.MountainVO">
		select * from tbl_mountain where no = #{no} 
	</select>
	
	<delete id="delete">
		delete from tbl_mountain where no = #{no}
	</delete>
	
	<update id="update">
		UPDATE mountain
		SET
		mName = #{mName},
		mLoc = #{mLoc},
		height = #{height},
		status = #{status}
		WHERE
		no = #{no}
	</update>
	
</mapper>	